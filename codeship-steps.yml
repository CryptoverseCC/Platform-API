- type: serial
  steps:

    - type: parallel
      steps:

        - service: ranking-worker-simple
          type: push
          image_name: userfeeds/apps-ranking-runners-simple
          image_tag: '{{.Branch}}'
          registry: https://index.docker.io/v1/
          encrypted_dockercfg_path: dockercfg.encrypted

        - service: ranking-worker-queue
          type: push
          image_name: userfeeds/apps-ranking-queue
          image_tag: '{{.Branch}}'
          registry: https://index.docker.io/v1/
          encrypted_dockercfg_path: dockercfg.encrypted

        - service: ranking-server
          type: push
          image_name: userfeeds/apps-ranking-server
          image_tag: '{{.Branch}}'
          registry: https://index.docker.io/v1/
          encrypted_dockercfg_path: dockercfg.encrypted

    - type: parallel
      steps:

        - service: deploy
          tag: '^\d+\.\d+\.\d+-\w+$'
          command: /app/deploy_by_tag_name.sh jazz
          registry: https://index.docker.io/v1/
          encrypted_dockercfg_path: dockercfg.encrypted
